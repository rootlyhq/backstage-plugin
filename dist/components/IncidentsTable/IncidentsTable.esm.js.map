{"version":3,"file":"IncidentsTable.esm.js","sources":["../../../src/components/IncidentsTable/IncidentsTable.tsx"],"sourcesContent":["import { Table, TableColumn } from '@backstage/core-components';\nimport { Chip, makeStyles, Tooltip } from '@material-ui/core';\nimport Link from '@material-ui/core/Link';\nimport { Alert } from '@material-ui/lab';\nimport React, { useState } from 'react';\nimport { useAsync } from 'react-use';\nimport { IncidentWrapper } from '../Incident';\nimport { ColoredChip } from '../UI/ColoredChip';\nimport { ColoredChips } from '../UI/ColoredChips';\nimport { StatusChip } from '../UI/StatusChip';\n\nimport {\n  RootlyIncident,\n  RootlyIncidentsFetchOpts,\n} from '@rootly/backstage-plugin-common';\nimport { useRootlyClient } from '../../api';\n\nimport {\n  SearchBarBase,\n} from '@backstage/plugin-search-react'; // Updated import\n\nconst useStyles = makeStyles(theme => ({\n  container: {\n    width: 850,\n  },\n  empty: {\n    padding: theme.spacing(2),\n    display: 'flex',\n    justifyContent: 'center',\n  },\n  searchContainer: {\n    display: 'flex',\n    justifyContent: 'flex-end',\n    marginBottom: theme.spacing(2),\n  },\n}));\n\nconst DEFAULT_PAGE_NUMBER = 1;\nconst DEFAULT_PAGE_SIZE = 10;\n\nexport const IncidentsTable = ({\n  organizationId,\n  params,\n}: {\n  organizationId?: string;\n  params?: RootlyIncidentsFetchOpts;\n}) => {\n  const classes = useStyles();\n  const rootlyClient = useRootlyClient({organizationId: organizationId});\n\n  const smallColumnStyle = {\n    width: '5%',\n    maxWidth: '5%',\n  };\n  const mediumColumnStyle = {\n    width: '10%',\n    maxWidth: '10%',\n  };\n\n  const [page, setPage] = useState({\n    number: DEFAULT_PAGE_NUMBER,\n    size: DEFAULT_PAGE_SIZE,\n  });\n\n  const [searchTerm, setSearchTerm] = useState(''); // State for search term\n\n  const {\n    value: response,\n    loading,\n    error,\n  } = useAsync(\n    async () =>\n      await rootlyClient.getIncidents({\n        ...params,\n        page: page,\n        filter: { search: searchTerm, ...params?.filter },\n      }), // Pass search term to API\n    [organizationId, page, searchTerm],\n  );\n\n  const columns: TableColumn<IncidentWrapper>[] = [\n    {\n      title: 'Started At',\n      field: 'incident.attributes.started_at',\n      type: 'datetime',\n      dateSetting: { locale: 'en-US' },\n      cellStyle: mediumColumnStyle,\n      headerStyle: mediumColumnStyle,\n    },\n    {\n      title: 'Title',\n      field: 'title',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => (\n        <Tooltip\n          title={\n            rowData.incident.attributes.summary?.substring(0, 255) ||\n            rowData.incident.attributes.title\n          }\n        >\n          <Link target=\"_blank\" href={rowData.incident.attributes.url}>\n            {rowData.incident.attributes.title}\n          </Link>\n        </Tooltip>\n      ),\n    },\n    {\n      title: 'Started By',\n      field: 'user.full_name',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => (\n        <Chip\n          label={rowData.incident.attributes.user?.data.attributes.full_name}\n          size=\"small\"\n        />\n      ),\n    },\n    {\n      title: 'Status',\n      field: 'status',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => (\n        <StatusChip status={rowData.incident.attributes.status} />\n      ),\n    },\n    {\n      title: 'Severity',\n      field: 'severity',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => (\n        <ColoredChip\n          label={rowData.incident.attributes.severity?.data.attributes.name}\n          tooltip={\n            rowData.incident.attributes.severity?.data.attributes.description\n          }\n          color={rowData.incident.attributes.severity?.data.attributes.color}\n        />\n      ),\n    },\n    {\n      title: 'Environments',\n      field: 'environments',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => <ColoredChips objects={rowData.environments()} />,\n    },\n    {\n      title: 'Services',\n      field: 'services',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => <ColoredChips objects={rowData.services()} />,\n    },\n    {\n      title: 'Functionalities',\n      field: 'functionalities',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => <ColoredChips objects={rowData.functionalities()} />,\n    },\n    {\n      title: 'Teams',\n      field: 'teams',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => <ColoredChips objects={rowData.groups()} />,\n    },\n  ];\n\n  if (error) {\n    return <Alert severity=\"error\">{error.message}</Alert>;\n  }\n\n  const data = response\n    ? response.data.map((i: RootlyIncident) => {\n        return new IncidentWrapper(i, response.included);\n      })\n    : [];\n\n  return (\n    <>\n      <div className={classes.searchContainer}>\n        {/* Backstage SearchBar */}\n        <SearchBarBase\n          onChange={setSearchTerm} // Directly pass the search term to setSearchTerm\n          placeholder=\"Search Incidents\"\n          value={searchTerm}\n        />\n      </div>\n      <Table\n        isLoading={loading}\n        options={{\n          sorting: true,\n          search: false, // Disabling built-in search as we are doing a custom search\n          paging: true,\n          actionsColumnIndex: -1,\n          pageSize: DEFAULT_PAGE_SIZE,\n          padding: 'dense',\n        }}\n        localization={{ header: { actions: undefined } }}\n        columns={columns}\n        data={data}\n        page={page.number - 1}\n        totalCount={response?.meta.total_count}\n        emptyContent={<div className={classes.empty}>No incidents</div>}\n        onPageChange={pageIndex => setPage({ ...page, number: pageIndex + 1 })}\n        onRowsPerPageChange={rowsPerPage =>\n          setPage({ ...page, size: rowsPerPage })\n        }\n      />\n    </>\n  );\n};\n"],"names":[],"mappings":"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"}